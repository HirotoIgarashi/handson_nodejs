'use strict';function cov_6i00g93os(){var path="/home/hiroto/git/handson_nodejs/todo-data-storage/app.js";var hash="7b96d71c8bbe013240cb43c1ae19ef3e90f905ca";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/home/hiroto/git/handson_nodejs/todo-data-storage/app.js",statementMap:{"0":{start:{line:3,column:16},end:{line:3,column:34}},"1":{start:{line:4,column:23},end:{line:4,column:38}},"2":{start:{line:7,column:20},end:{line:7,column:67}},"3":{start:{line:9,column:12},end:{line:9,column:21}},"4":{start:{line:11,column:0},end:{line:11,column:24}},"5":{start:{line:14,column:0},end:{line:20,column:3}},"6":{start:{line:15,column:2},end:{line:17,column:3}},"7":{start:{line:16,column:4},end:{line:16,column:71}},"8":{start:{line:16,column:48},end:{line:16,column:63}},"9":{start:{line:18,column:20},end:{line:18,column:50}},"10":{start:{line:19,column:2},end:{line:19,column:78}},"11":{start:{line:23,column:0},end:{line:34,column:3}},"12":{start:{line:24,column:20},end:{line:24,column:28}},"13":{start:{line:26,column:2},end:{line:31,column:3}},"14":{start:{line:28,column:16},end:{line:28,column:46}},"15":{start:{line:29,column:4},end:{line:29,column:25}},"16":{start:{line:30,column:4},end:{line:30,column:21}},"17":{start:{line:32,column:15},end:{line:32,column:70}},"18":{start:{line:33,column:2},end:{line:33,column:72}},"19":{start:{line:33,column:38},end:{line:33,column:64}},"20":{start:{line:38,column:2},end:{line:47,column:14}},"21":{start:{line:39,column:4},end:{line:47,column:14}},"22":{start:{line:41,column:8},end:{line:43,column:9}},"23":{start:{line:42,column:10},end:{line:42,column:32}},"24":{start:{line:44,column:20},end:{line:44,column:47}},"25":{start:{line:45,column:8},end:{line:45,column:29}},"26":{start:{line:46,column:8},end:{line:46,column:18}},"27":{start:{line:51,column:0},end:{line:53,column:34}},"28":{start:{line:56,column:0},end:{line:65,column:3}},"29":{start:{line:57,column:2},end:{line:64,column:11}},"30":{start:{line:58,column:4},end:{line:60,column:5}},"31":{start:{line:59,column:6},end:{line:59,column:35}},"32":{start:{line:61,column:16},end:{line:61,column:43}},"33":{start:{line:62,column:4},end:{line:62,column:25}},"34":{start:{line:63,column:4},end:{line:63,column:14}},"35":{start:{line:68,column:0},end:{line:71,column:3}},"36":{start:{line:69,column:2},end:{line:69,column:21}},"37":{start:{line:70,column:2},end:{line:70,column:65}},"38":{start:{line:74,column:0},end:{line:74,column:34}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:14,column:22},end:{line:14,column:23}},loc:{start:{line:14,column:42},end:{line:20,column:1}},line:14},"1":{name:"(anonymous_1)",decl:{start:{line:16,column:39},end:{line:16,column:40}},loc:{start:{line:16,column:48},end:{line:16,column:63}},line:16},"2":{name:"(anonymous_2)",decl:{start:{line:23,column:23},end:{line:23,column:24}},loc:{start:{line:23,column:43},end:{line:34,column:1}},line:23},"3":{name:"(anonymous_3)",decl:{start:{line:33,column:32},end:{line:33,column:33}},loc:{start:{line:33,column:38},end:{line:33,column:64}},line:33},"4":{name:"completedHandler",decl:{start:{line:37,column:9},end:{line:37,column:25}},loc:{start:{line:37,column:37},end:{line:48,column:1}},line:37},"5":{name:"(anonymous_5)",decl:{start:{line:38,column:9},end:{line:38,column:10}},loc:{start:{line:39,column:4},end:{line:47,column:14}},line:39},"6":{name:"(anonymous_6)",decl:{start:{line:40,column:12},end:{line:40,column:13}},loc:{start:{line:40,column:20},end:{line:47,column:7}},line:40},"7":{name:"(anonymous_7)",decl:{start:{line:56,column:29},end:{line:56,column:30}},loc:{start:{line:56,column:49},end:{line:65,column:1}},line:56},"8":{name:"(anonymous_8)",decl:{start:{line:57,column:41},end:{line:57,column:42}},loc:{start:{line:57,column:47},end:{line:64,column:3}},line:57},"9":{name:"(anonymous_9)",decl:{start:{line:68,column:8},end:{line:68,column:9}},loc:{start:{line:68,column:33},end:{line:71,column:1}},line:68}},branchMap:{"0":{loc:{start:{line:15,column:2},end:{line:17,column:3}},type:"if",locations:[{start:{line:15,column:2},end:{line:17,column:3}},{start:{line:15,column:2},end:{line:17,column:3}}],line:15},"1":{loc:{start:{line:26,column:2},end:{line:31,column:3}},type:"if",locations:[{start:{line:26,column:2},end:{line:31,column:3}},{start:{line:26,column:2},end:{line:31,column:3}}],line:26},"2":{loc:{start:{line:26,column:6},end:{line:26,column:41}},type:"binary-expr",locations:[{start:{line:26,column:6},end:{line:26,column:31}},{start:{line:26,column:35},end:{line:26,column:41}}],line:26},"3":{loc:{start:{line:41,column:8},end:{line:43,column:9}},type:"if",locations:[{start:{line:41,column:8},end:{line:43,column:9}},{start:{line:41,column:8},end:{line:43,column:9}}],line:41},"4":{loc:{start:{line:58,column:4},end:{line:60,column:5}},type:"if",locations:[{start:{line:58,column:4},end:{line:60,column:5}},{start:{line:58,column:4},end:{line:60,column:5}}],line:58},"5":{loc:{start:{line:70,column:13},end:{line:70,column:34}},type:"binary-expr",locations:[{start:{line:70,column:13},end:{line:70,column:27}},{start:{line:70,column:31},end:{line:70,column:34}}],line:70}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"7b96d71c8bbe013240cb43c1ae19ef3e90f905ca"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_6i00g93os=function(){return actualCoverage;};}return actualCoverage;}cov_6i00g93os();const express=(cov_6i00g93os().s[0]++,require('express'));const{v4:uuidv4}=(cov_6i00g93os().s[1]++,require('uuid'));// 実行されたスクリプトの名前に応じてデータストレージの実装を使い分ける
const dataStorage=(cov_6i00g93os().s[2]++,require(`./${process.env.npm_lifecycle_event}`));const app=(cov_6i00g93os().s[3]++,express());cov_6i00g93os().s[4]++;app.use(express.json());// ToDo一覧の取得
cov_6i00g93os().s[5]++;app.get('/api/todos',(req,res,next)=>{cov_6i00g93os().f[0]++;cov_6i00g93os().s[6]++;if(!req.query.completed){cov_6i00g93os().b[0][0]++;cov_6i00g93os().s[7]++;return dataStorage.fetchAll().then(todos=>{cov_6i00g93os().f[1]++;cov_6i00g93os().s[8]++;return res.json(todos);},next);}else{cov_6i00g93os().b[0][1]++;}const completed=(cov_6i00g93os().s[9]++,req.query.completed==='true');cov_6i00g93os().s[10]++;dataStorage.fetchByCompleted(completed).then(todos=res.json(todos),next);});// ToDoの新規登録
cov_6i00g93os().s[11]++;app.post('/api/todos',(req,res,next)=>{cov_6i00g93os().f[2]++;const{title}=(cov_6i00g93os().s[12]++,req.body);cov_6i00g93os().s[13]++;if((cov_6i00g93os().b[2][0]++,typeof title!=='string')||(cov_6i00g93os().b[2][1]++,!title)){cov_6i00g93os().b[1][0]++;// titleがリクエストに含まれない場合はステータスコード400(Bad Request)
const err=(cov_6i00g93os().s[14]++,new Error('title is required'));cov_6i00g93os().s[15]++;err.statusCode=400;cov_6i00g93os().s[16]++;return next(err);}else{cov_6i00g93os().b[1][1]++;}const todo=(cov_6i00g93os().s[17]++,{id:uuidv4()/* UUIDの生成 */,title,completed:false});cov_6i00g93os().s[18]++;dataStorage.create(todo).then(()=>{cov_6i00g93os().f[3]++;cov_6i00g93os().s[19]++;return res.status(201).json(todo);},next);});/** Completedの設定、解除の共通処理 **/function completedHandler(completed){cov_6i00g93os().f[4]++;cov_6i00g93os().s[20]++;return(req,res,next)=>{cov_6i00g93os().f[5]++;cov_6i00g93os().s[21]++;return dataStorage.update(req.params.id,{completed}).then(todo=>{cov_6i00g93os().f[6]++;cov_6i00g93os().s[22]++;if(todo){cov_6i00g93os().b[3][0]++;cov_6i00g93os().s[23]++;return res.json(todo);}else{cov_6i00g93os().b[3][1]++;}const err=(cov_6i00g93os().s[24]++,new Error('ToDo not found'));cov_6i00g93os().s[25]++;err.statusCode=404;cov_6i00g93os().s[26]++;next(err);},next);};};// ToDoのCompletedの設定、解除
cov_6i00g93os().s[27]++;app.route('/api/todos/:id/completed').put(completedHandler(true)).delete(completedHandler(false));// ToDoの削除
cov_6i00g93os().s[28]++;app.delete('/api/todos/:id',(req,res,next)=>{cov_6i00g93os().f[7]++;cov_6i00g93os().s[29]++;dataStorage.remove(req.params.id).then(id=>{cov_6i00g93os().f[8]++;cov_6i00g93os().s[30]++;if(id!==null){cov_6i00g93os().b[4][0]++;cov_6i00g93os().s[31]++;return res.status(204).end();}else{cov_6i00g93os().b[4][1]++;}const err=(cov_6i00g93os().s[32]++,new Error('ToDo not found'));cov_6i00g93os().s[33]++;err.statusCode=404;cov_6i00g93os().s[34]++;next(err);},next);});// エラーハンドリングミドルウェア
cov_6i00g93os().s[35]++;app.use((err,req,res,next)=>{cov_6i00g93os().f[9]++;cov_6i00g93os().s[36]++;console.error(err);cov_6i00g93os().s[37]++;res.status((cov_6i00g93os().b[5][0]++,err.statusCode)||(cov_6i00g93os().b[5][1]++,500)).json({error:err.message});});// "module.exports"を追加
cov_6i00g93os().s[38]++;module.exports=app.listen(3000);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyJdLCJuYW1lcyI6WyJleHByZXNzIiwicmVxdWlyZSIsInY0IiwidXVpZHY0IiwiZGF0YVN0b3JhZ2UiLCJwcm9jZXNzIiwiZW52IiwibnBtX2xpZmVjeWNsZV9ldmVudCIsImFwcCIsInVzZSIsImpzb24iLCJnZXQiLCJyZXEiLCJyZXMiLCJuZXh0IiwicXVlcnkiLCJjb21wbGV0ZWQiLCJmZXRjaEFsbCIsInRoZW4iLCJ0b2RvcyIsImZldGNoQnlDb21wbGV0ZWQiLCJwb3N0IiwidGl0bGUiLCJib2R5IiwiZXJyIiwiRXJyb3IiLCJzdGF0dXNDb2RlIiwidG9kbyIsImlkIiwiY3JlYXRlIiwic3RhdHVzIiwiY29tcGxldGVkSGFuZGxlciIsInVwZGF0ZSIsInBhcmFtcyIsInJvdXRlIiwicHV0IiwiZGVsZXRlIiwicmVtb3ZlIiwiZW5kIiwiY29uc29sZSIsImVycm9yIiwibWVzc2FnZSIsIm1vZHVsZSIsImV4cG9ydHMiLCJsaXN0ZW4iXSwibWFwcGluZ3MiOiJBQUFBLGEsa3FMQWVZO3lGQWJaLEtBQU1BLENBQUFBLE9BQU8seUJBQUdDLE9BQU8sQ0FBQyxTQUFELENBQVYsQ0FBYixDQUNBLEtBQU0sQ0FBRUMsRUFBRSxDQUFFQyxNQUFOLDBCQUFpQkYsT0FBTyxDQUFDLE1BQUQsQ0FBeEIsQ0FBTixDQUVBO0FBQ0EsS0FBTUcsQ0FBQUEsV0FBVyx5QkFBR0gsT0FBTyxDQUFFLEtBQUlJLE9BQU8sQ0FBQ0MsR0FBUixDQUFZQyxtQkFBb0IsRUFBdEMsQ0FBVixDQUFqQixDQUVBLEtBQU1DLENBQUFBLEdBQUcseUJBQUdSLE9BQU8sRUFBVixDQUFULEMsdUJBRUFRLEdBQUcsQ0FBQ0MsR0FBSixDQUFRVCxPQUFPLENBQUNVLElBQVIsRUFBUixFQUVBO3VCQUNBRixHQUFHLENBQUNHLEdBQUosQ0FBUSxZQUFSLENBQXNCLENBQUNDLEdBQUQsQ0FBTUMsR0FBTixDQUFXQyxJQUFYLEdBQW9CLCtDQUN4QyxHQUFJLENBQUNGLEdBQUcsQ0FBQ0cs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RUFBRSxFQUFJLGdEQUMzQyxHQUFJQSxFQUFFLEdBQUssSUFBWCxDQUFpQixtREFDZixNQUFPZixDQUFBQSxHQUFHLENBQUNpQixNQUFKLENBQVcsR0FBWCxFQUFnQlEsR0FBaEIsRUFBUCxDQUNELENBRkQsZ0NBR0EsS0FBTWQsQ0FBQUEsR0FBRywwQkFBRyxHQUFJQyxDQUFBQSxLQUFKLENBQVUsZ0JBQVYsQ0FBSCxDQUFULENBSjJDLHdCQUszQ0QsR0FBRyxDQUFDRSxVQUFKLENBQWlCLEdBQWpCLENBTDJDLHdCQU0zQ1osSUFBSSxDQUFDVSxHQUFELENBQUosQ0FDRCxDQVBELENBT0dWLElBUEgsRUFRRCxDQVRELEVBV0E7d0JBQ0FOLEdBQUcsQ0FBQ0MsR0FBSixDQUFRLENBQUNlLEdBQUQsQ0FBTVosR0FBTixDQUFXQyxHQUFYLENBQWdCQyxJQUFoQixHQUF5QixnREFDL0J5QixPQUFPLENBQUNDLEtBQVIsQ0FBY2hCLEdBQWQsRUFEK0Isd0JBRS9CWCxHQUFHLENBQUNpQixNQUFKLENBQVcsMkJBQUFOLEdBQUcsQ0FBQ0UsVUFBSiw4QkFBa0IsR0FBbEIsQ0FBWCxFQUFrQ2hCLElBQWxDLENBQXVDLENBQUU4QixLQUFLLENBQUVoQixHQUFHLENBQUNpQixPQUFiLENBQXZDLEVBQ0QsQ0FIRCxFQUtBO3dCQUNBQyxNQUFNLENBQUNDLE9BQVAsQ0FBaUJuQyxHQUFHLENBQUNvQyxNQUFKLENBQVcsSUFBWCxDQUFqQiIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxuY29uc3QgZXhwcmVzcyA9IHJlcXVpcmUoJ2V4cHJlc3MnKTtcbmNvbnN0IHsgdjQ6IHV1aWR2NCB9ID0gcmVxdWlyZSgndXVpZCcpO1xuXG4vLyDlrp/ooYzjgZXjgozjgZ/jgrnjgq/jg6rjg5fjg4jjga7lkI3liY3jgavlv5zjgZjjgabjg4fjg7zjgr/jgrnjg4jjg6zjg7zjgrjjga7lrp/oo4XjgpLkvb/jgYTliIbjgZHjgotcbmNvbnN0IGRhdGFTdG9yYWdlID0gcmVxdWlyZShgLi8ke3Byb2Nlc3MuZW52Lm5wbV9saWZlY3ljbGVfZXZlbnR9YCk7XG5cbmNvbnN0IGFwcCA9IGV4cHJlc3MoKTtcblxuYXBwLnVzZShleHByZXNzLmpzb24oKSk7XG5cbi8vIFRvRG/kuIDopqfjga7lj5blvpdcbmFwcC5nZXQoJy9hcGkvdG9kb3MnLCAocmVxLCByZXMsIG5leHQpID0+IHtcbiAgaWYgKCFyZXEucXVlcnkuY29tcGxldGVkKSB7XG4gICAgcmV0dXJuIGRhdGFTdG9yYWdlLmZldGNoQWxsKCkudGhlbih0b2RvcyA9PiByZXMuanNvbih0b2RvcyksIG5leHQpO1xuICB9XG4gIGNvbnN0IGNvbXBsZXRlZCA9IHJlcS5xdWVyeS5jb21wbGV0ZWQgPT09ICd0cnVlJztcbiAgZGF0YVN0b3JhZ2UuZmV0Y2hCeUNvbXBsZXRlZChjb21wbGV0ZWQpLnRoZW4odG9kb3MgPSByZXMuanNvbih0b2RvcyksIG5leHQpO1xufSk7XG5cbi8vIFRvRG/jga7mlrDopo/nmbvpjLJcbmFwcC5wb3N0KCcvYXBpL3RvZG9zJywgKHJlcSwgcmVzLCBuZXh0KSA9PiB7XG4gIGNvbnN0IHsgdGl0bGUgfSA9IHJlcS5ib2R5O1xuXG4gIGlmICh0eXBlb2YgdGl0bGUgIT09ICdzdHJpbmcnIHx8ICF0aXRsZSkge1xuICAgIC8vIHRpdGxl44GM44Oq44Kv44Ko44K544OI44Gr5ZCr44G+44KM44Gq44GE5aC05ZCI44Gv44K544OG44O844K/44K544Kz44O844OJNDAwKEJhZCBSZXF1ZXN0KVxuICAgIGNvbnN0IGVyciA9IG5ldyBFcnJvcigndGl0bGUgaXMgcmVxdWlyZWQnKTtcbiAgICBlcnIuc3RhdHVzQ29kZSA9IDQwMDtcbiAgICByZXR1cm4gbmV4dChlcnIpO1xuICB9XG4gIGNvbnN0IHRvZG8gPSB7IGlkOiB1dWlkdjQoKSAvKiBVVUlE44Gu55Sf5oiQICovLCB0aXRsZSwgY29tcGxldGVkOiBmYWxzZSB9O1xuICBkYXRhU3RvcmFnZS5jcmVhdGUodG9kbykudGhlbigoKSA9PiByZXMuc3RhdHVzKDIwMSkuanNvbih0b2RvKSwgbmV4dCk7XG59KTtcblxuLyoqIENvbXBsZXRlZOOBruioreWumuOAgeino+mZpOOBruWFsemAmuWHpueQhiAqKi9cbmZ1bmN0aW9uIGNvbXBsZXRlZEhhbmRsZXIoY29tcGxldGVkKSB7XG4gIHJldHVybiAocmVxLCByZXMsIG5leHQpID0+XG4gICAgZGF0YVN0b3JhZ2UudXBkYXRlKHJlcS5wYXJhbXMuaWQsIHsgY29tcGxldGVkIH0pXG4gICAgICAudGhlbih0b2RvID0+IHtcbiAgICAgICAgaWYgKHRvZG8pIHtcbiAgICAgICAgICByZXR1cm4gcmVzLmpzb24odG9kbyk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgZXJyID0gbmV3IEVycm9yKCdUb0RvIG5vdCBmb3VuZCcpO1xuICAgICAgICBlcnIuc3RhdHVzQ29kZSA9IDQwNDtcbiAgICAgICAgbmV4dChlcnIpO1xuICAgICAgfSwgbmV4dClcbn07XG5cbi8vIFRvRG/jga5Db21wbGV0ZWTjga7oqK3lrprjgIHop6PpmaRcbmFwcC5yb3V0ZSgnL2FwaS90b2Rvcy86aWQvY29tcGxldGVkJylcbiAgLnB1dChjb21wbGV0ZWRIYW5kbGVyKHRydWUpKVxuICAuZGVsZXRlKGNvbXBsZXRlZEhhbmRsZXIoZmFsc2UpKVxuXG4vLyBUb0Rv44Gu5YmK6ZmkXG5hcHAuZGVsZXRlKCcvYXBpL3RvZG9zLzppZCcsIChyZXEsIHJlcywgbmV4dCkgPT4ge1xuICBkYXRhU3RvcmFnZS5yZW1vdmUocmVxLnBhcmFtcy5pZCkudGhlbihpZCA9PiB7XG4gICAgaWYgKGlkICE9PSBudWxsKSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cygyMDQpLmVuZCgpO1xuICAgIH1cbiAgICBjb25zdCBlcnIgPSBuZXcgRXJyb3IoJ1RvRG8gbm90IGZvdW5kJyk7XG4gICAgZXJyLnN0YXR1c0NvZGUgPSA0MDQ7XG4gICAgbmV4dChlcnIpO1xuICB9LCBuZXh0KTtcbn0pO1xuXG4vLyDjgqjjg6njg7zjg4/jg7Pjg4njg6rjg7PjgrDjg5/jg4njg6vjgqbjgqfjgqJcbmFwcC51c2UoKGVyciwgcmVxLCByZXMsIG5leHQpID0+IHtcbiAgY29uc29sZS5lcnJvcihlcnIpO1xuICByZXMuc3RhdHVzKGVyci5zdGF0dXNDb2RlIHx8IDUwMCkuanNvbih7IGVycm9yOiBlcnIubWVzc2FnZSB9KTtcbn0pO1xuXG4vLyBcIm1vZHVsZS5leHBvcnRzXCLjgpLov73liqBcbm1vZHVsZS5leHBvcnRzID0gYXBwLmxpc3RlbigzMDAwKTtcbiJdfQ==