'use strict';function cov_6i00g93os(){var path="/home/hiroto/git/handson_nodejs/todo-data-storage/app.js";var hash="ff8bde0ea0b6a140e2b27d907919ce20adf6f735";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/home/hiroto/git/handson_nodejs/todo-data-storage/app.js",statementMap:{"0":{start:{line:2,column:16},end:{line:2,column:34}},"1":{start:{line:3,column:23},end:{line:3,column:38}},"2":{start:{line:6,column:20},end:{line:6,column:67}},"3":{start:{line:8,column:12},end:{line:8,column:21}},"4":{start:{line:10,column:0},end:{line:10,column:24}},"5":{start:{line:13,column:0},end:{line:19,column:3}},"6":{start:{line:14,column:2},end:{line:16,column:3}},"7":{start:{line:15,column:4},end:{line:15,column:71}},"8":{start:{line:15,column:48},end:{line:15,column:63}},"9":{start:{line:17,column:20},end:{line:17,column:50}},"10":{start:{line:18,column:2},end:{line:18,column:79}},"11":{start:{line:18,column:56},end:{line:18,column:71}},"12":{start:{line:22,column:0},end:{line:33,column:3}},"13":{start:{line:23,column:20},end:{line:23,column:28}},"14":{start:{line:25,column:2},end:{line:30,column:3}},"15":{start:{line:27,column:16},end:{line:27,column:46}},"16":{start:{line:28,column:4},end:{line:28,column:25}},"17":{start:{line:29,column:4},end:{line:29,column:21}},"18":{start:{line:31,column:15},end:{line:31,column:70}},"19":{start:{line:32,column:2},end:{line:32,column:72}},"20":{start:{line:32,column:38},end:{line:32,column:64}},"21":{start:{line:37,column:2},end:{line:46,column:14}},"22":{start:{line:38,column:4},end:{line:46,column:14}},"23":{start:{line:40,column:8},end:{line:42,column:9}},"24":{start:{line:41,column:10},end:{line:41,column:32}},"25":{start:{line:43,column:20},end:{line:43,column:47}},"26":{start:{line:44,column:8},end:{line:44,column:29}},"27":{start:{line:45,column:8},end:{line:45,column:18}},"28":{start:{line:50,column:0},end:{line:52,column:34}},"29":{start:{line:55,column:0},end:{line:64,column:3}},"30":{start:{line:56,column:2},end:{line:63,column:11}},"31":{start:{line:57,column:4},end:{line:59,column:5}},"32":{start:{line:58,column:6},end:{line:58,column:35}},"33":{start:{line:60,column:16},end:{line:60,column:43}},"34":{start:{line:61,column:4},end:{line:61,column:25}},"35":{start:{line:62,column:4},end:{line:62,column:14}},"36":{start:{line:67,column:0},end:{line:70,column:3}},"37":{start:{line:68,column:2},end:{line:68,column:21}},"38":{start:{line:69,column:2},end:{line:69,column:65}},"39":{start:{line:73,column:0},end:{line:73,column:34}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:13,column:22},end:{line:13,column:23}},loc:{start:{line:13,column:42},end:{line:19,column:1}},line:13},"1":{name:"(anonymous_1)",decl:{start:{line:15,column:39},end:{line:15,column:40}},loc:{start:{line:15,column:48},end:{line:15,column:63}},line:15},"2":{name:"(anonymous_2)",decl:{start:{line:18,column:47},end:{line:18,column:48}},loc:{start:{line:18,column:56},end:{line:18,column:71}},line:18},"3":{name:"(anonymous_3)",decl:{start:{line:22,column:23},end:{line:22,column:24}},loc:{start:{line:22,column:43},end:{line:33,column:1}},line:22},"4":{name:"(anonymous_4)",decl:{start:{line:32,column:32},end:{line:32,column:33}},loc:{start:{line:32,column:38},end:{line:32,column:64}},line:32},"5":{name:"completedHandler",decl:{start:{line:36,column:9},end:{line:36,column:25}},loc:{start:{line:36,column:37},end:{line:47,column:1}},line:36},"6":{name:"(anonymous_6)",decl:{start:{line:37,column:9},end:{line:37,column:10}},loc:{start:{line:38,column:4},end:{line:46,column:14}},line:38},"7":{name:"(anonymous_7)",decl:{start:{line:39,column:12},end:{line:39,column:13}},loc:{start:{line:39,column:20},end:{line:46,column:7}},line:39},"8":{name:"(anonymous_8)",decl:{start:{line:55,column:29},end:{line:55,column:30}},loc:{start:{line:55,column:49},end:{line:64,column:1}},line:55},"9":{name:"(anonymous_9)",decl:{start:{line:56,column:41},end:{line:56,column:42}},loc:{start:{line:56,column:47},end:{line:63,column:3}},line:56},"10":{name:"(anonymous_10)",decl:{start:{line:67,column:8},end:{line:67,column:9}},loc:{start:{line:67,column:33},end:{line:70,column:1}},line:67}},branchMap:{"0":{loc:{start:{line:14,column:2},end:{line:16,column:3}},type:"if",locations:[{start:{line:14,column:2},end:{line:16,column:3}},{start:{line:14,column:2},end:{line:16,column:3}}],line:14},"1":{loc:{start:{line:25,column:2},end:{line:30,column:3}},type:"if",locations:[{start:{line:25,column:2},end:{line:30,column:3}},{start:{line:25,column:2},end:{line:30,column:3}}],line:25},"2":{loc:{start:{line:25,column:6},end:{line:25,column:41}},type:"binary-expr",locations:[{start:{line:25,column:6},end:{line:25,column:31}},{start:{line:25,column:35},end:{line:25,column:41}}],line:25},"3":{loc:{start:{line:40,column:8},end:{line:42,column:9}},type:"if",locations:[{start:{line:40,column:8},end:{line:42,column:9}},{start:{line:40,column:8},end:{line:42,column:9}}],line:40},"4":{loc:{start:{line:57,column:4},end:{line:59,column:5}},type:"if",locations:[{start:{line:57,column:4},end:{line:59,column:5}},{start:{line:57,column:4},end:{line:59,column:5}}],line:57},"5":{loc:{start:{line:69,column:13},end:{line:69,column:34}},type:"binary-expr",locations:[{start:{line:69,column:13},end:{line:69,column:27}},{start:{line:69,column:31},end:{line:69,column:34}}],line:69}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"ff8bde0ea0b6a140e2b27d907919ce20adf6f735"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_6i00g93os=function(){return actualCoverage;};}return actualCoverage;}cov_6i00g93os();const express=(cov_6i00g93os().s[0]++,require('express'));const{v4:uuidv4}=(cov_6i00g93os().s[1]++,require('uuid'));// 実行されたスクリプトの名前に応じてデータストレージの実装を使い分ける
const dataStorage=(cov_6i00g93os().s[2]++,require(`./${process.env.npm_lifecycle_event}`));const app=(cov_6i00g93os().s[3]++,express());cov_6i00g93os().s[4]++;app.use(express.json());// ToDo一覧の取得
cov_6i00g93os().s[5]++;app.get('/api/todos',(req,res,next)=>{cov_6i00g93os().f[0]++;cov_6i00g93os().s[6]++;if(!req.query.completed){cov_6i00g93os().b[0][0]++;cov_6i00g93os().s[7]++;return dataStorage.fetchAll().then(todos=>{cov_6i00g93os().f[1]++;cov_6i00g93os().s[8]++;return res.json(todos);},next);}else{cov_6i00g93os().b[0][1]++;}const completed=(cov_6i00g93os().s[9]++,req.query.completed==='true');cov_6i00g93os().s[10]++;dataStorage.fetchByCompleted(completed).then(todos=>{cov_6i00g93os().f[2]++;cov_6i00g93os().s[11]++;return res.json(todos);},next);});// ToDoの新規登録
cov_6i00g93os().s[12]++;app.post('/api/todos',(req,res,next)=>{cov_6i00g93os().f[3]++;const{title}=(cov_6i00g93os().s[13]++,req.body);cov_6i00g93os().s[14]++;if((cov_6i00g93os().b[2][0]++,typeof title!=='string')||(cov_6i00g93os().b[2][1]++,!title)){cov_6i00g93os().b[1][0]++;// titleがリクエストに含まれない場合はステータスコード400(Bad Request)
const err=(cov_6i00g93os().s[15]++,new Error('title is required'));cov_6i00g93os().s[16]++;err.statusCode=400;cov_6i00g93os().s[17]++;return next(err);}else{cov_6i00g93os().b[1][1]++;}const todo=(cov_6i00g93os().s[18]++,{id:uuidv4()/* UUIDの生成 */,title,completed:false});cov_6i00g93os().s[19]++;dataStorage.create(todo).then(()=>{cov_6i00g93os().f[4]++;cov_6i00g93os().s[20]++;return res.status(201).json(todo);},next);});/** Completedの設定、解除の共通処理 **/function completedHandler(completed){cov_6i00g93os().f[5]++;cov_6i00g93os().s[21]++;return(req,res,next)=>{cov_6i00g93os().f[6]++;cov_6i00g93os().s[22]++;return dataStorage.update(req.params.id,{completed}).then(todo=>{cov_6i00g93os().f[7]++;cov_6i00g93os().s[23]++;if(todo){cov_6i00g93os().b[3][0]++;cov_6i00g93os().s[24]++;return res.json(todo);}else{cov_6i00g93os().b[3][1]++;}const err=(cov_6i00g93os().s[25]++,new Error('ToDo not found'));cov_6i00g93os().s[26]++;err.statusCode=404;cov_6i00g93os().s[27]++;next(err);},next);};};// ToDoのCompletedの設定、解除
cov_6i00g93os().s[28]++;app.route('/api/todos/:id/completed').put(completedHandler(true)).delete(completedHandler(false));// ToDoの削除
cov_6i00g93os().s[29]++;app.delete('/api/todos/:id',(req,res,next)=>{cov_6i00g93os().f[8]++;cov_6i00g93os().s[30]++;dataStorage.remove(req.params.id).then(id=>{cov_6i00g93os().f[9]++;cov_6i00g93os().s[31]++;if(id!==null){cov_6i00g93os().b[4][0]++;cov_6i00g93os().s[32]++;return res.status(204).end();}else{cov_6i00g93os().b[4][1]++;}const err=(cov_6i00g93os().s[33]++,new Error('ToDo not found'));cov_6i00g93os().s[34]++;err.statusCode=404;cov_6i00g93os().s[35]++;next(err);},next);});// エラーハンドリングミドルウェア
cov_6i00g93os().s[36]++;app.use((err,req,res,next)=>{cov_6i00g93os().f[10]++;cov_6i00g93os().s[37]++;console.error(err);cov_6i00g93os().s[38]++;res.status((cov_6i00g93os().b[5][0]++,err.statusCode)||(cov_6i00g93os().b[5][1]++,500)).json({error:err.message});});// "module.exports"を追加
cov_6i00g93os().s[39]++;module.exports=app.listen(3000);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyJdLCJuYW1lcyI6WyJleHByZXNzIiwicmVxdWlyZSIsInY0IiwidXVpZHY0IiwiZGF0YVN0b3JhZ2UiLCJwcm9jZXNzIiwiZW52IiwibnBtX2xpZmVjeWNsZV9ldmVudCIsImFwcCIsInVzZSIsImpzb24iLCJnZXQiLCJyZXEiLCJyZXMiLCJuZXh0IiwicXVlcnkiLCJjb21wbGV0ZWQiLCJmZXRjaEFsbCIsInRoZW4iLCJ0b2RvcyIsImZldGNoQnlDb21wbGV0ZWQiLCJwb3N0IiwidGl0bGUiLCJib2R5IiwiZXJyIiwiRXJyb3IiLCJzdGF0dXNDb2RlIiwidG9kbyIsImlkIiwiY3JlYXRlIiwic3RhdHVzIiwiY29tcGxldGVkSGFuZGxlciIsInVwZGF0ZSIsInBhcmFtcyIsInJvdXRlIiwicHV0IiwiZGVsZXRlIiwicmVtb3ZlIiwiZW5kIiwiY29uc29sZSIsImVycm9yIiwibWVzc2FnZSIsIm1vZHVsZSIsImV4cG9ydHMiLCJsaXN0ZW4iXSwibWFwcGluZ3MiOiJBQUFBLGEsKzNMQWVZO3lGQWRaLEtBQU1BLENBQUFBLE9BQU8seUJBQUdDLE9BQU8sQ0FBQyxTQUFELENBQVYsQ0FBYixDQUNBLEtBQU0sQ0FBRUMsRUFBRSxDQUFFQyxNQUFOLDBCQUFpQkYsT0FBTyxDQUFDLE1BQUQsQ0FBeEIsQ0FBTixDQUVBO0FBQ0EsS0FBTUcsQ0FBQUEsV0FBVyx5QkFBR0gsT0FBTyxDQUFFLEtBQUlJLE9BQU8sQ0FBQ0MsR0FBUixDQUFZQyxtQkFBb0IsRUFBdEMsQ0FBVixDQUFqQixDQUVBLEtBQU1DLENBQUFBLEdBQUcseUJBQUdSLE9BQU8sRUFBVixDQUFULEMsdUJBRUFRLEdBQUcsQ0FBQ0MsR0FBSixDQUFRVCxPQUFPLENBQUNVLElBQVIsRUFBUixFQUVBO3VCQUNBRixHQUFHLENBQUNHLEdBQUosQ0FBUSxZQUFSLENBQXNCLENBQUNDLEdBQUQsQ0FBTUMsR0FBTixDQUFXQyxJQUFYLEdBQW9CLCtDQUN4QyxHQUFJLENBQUNGLEdBQUcsQ0FBQ0cs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a0NWLElBQWxDLENBQXVDVSxFQUFFLEVBQUksZ0RBQzNDLEdBQUlBLEVBQUUsR0FBSyxJQUFYLENBQWlCLG1EQUNmLE1BQU9mLENBQUFBLEdBQUcsQ0FBQ2lCLE1BQUosQ0FBVyxHQUFYLEVBQWdCUSxHQUFoQixFQUFQLENBQ0QsQ0FGRCxnQ0FHQSxLQUFNZCxDQUFBQSxHQUFHLDBCQUFHLEdBQUlDLENBQUFBLEtBQUosQ0FBVSxnQkFBVixDQUFILENBQVQsQ0FKMkMsd0JBSzNDRCxHQUFHLENBQUNFLFVBQUosQ0FBaUIsR0FBakIsQ0FMMkMsd0JBTTNDWixJQUFJLENBQUNVLEdBQUQsQ0FBSixDQUNELENBUEQsQ0FPR1YsSUFQSCxFQVFELENBVEQsRUFXQTt3QkFDQU4sR0FBRyxDQUFDQyxHQUFKLENBQVEsQ0FBQ2UsR0FBRCxDQUFNWixHQUFOLENBQVdDLEdBQVgsQ0FBZ0JDLElBQWhCLEdBQXlCLGlEQUMvQnlCLE9BQU8sQ0FBQ0MsS0FBUixDQUFjaEIsR0FBZCxFQUQrQix3QkFFL0JYLEdBQUcsQ0FBQ2lCLE1BQUosQ0FBVywyQkFBQU4sR0FBRyxDQUFDRSxVQUFKLDhCQUFrQixHQUFsQixDQUFYLEVBQWtDaEIsSUFBbEMsQ0FBdUMsQ0FBRThCLEtBQUssQ0FBRWhCLEdBQUcsQ0FBQ2lCLE9BQWIsQ0FBdkMsRUFDRCxDQUhELEVBS0E7d0JBQ0FDLE1BQU0sQ0FBQ0MsT0FBUCxDQUFpQm5DLEdBQUcsQ0FBQ29DLE1BQUosQ0FBVyxJQUFYLENBQWpCIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuY29uc3QgZXhwcmVzcyA9IHJlcXVpcmUoJ2V4cHJlc3MnKTtcbmNvbnN0IHsgdjQ6IHV1aWR2NCB9ID0gcmVxdWlyZSgndXVpZCcpO1xuXG4vLyDlrp/ooYzjgZXjgozjgZ/jgrnjgq/jg6rjg5fjg4jjga7lkI3liY3jgavlv5zjgZjjgabjg4fjg7zjgr/jgrnjg4jjg6zjg7zjgrjjga7lrp/oo4XjgpLkvb/jgYTliIbjgZHjgotcbmNvbnN0IGRhdGFTdG9yYWdlID0gcmVxdWlyZShgLi8ke3Byb2Nlc3MuZW52Lm5wbV9saWZlY3ljbGVfZXZlbnR9YCk7XG5cbmNvbnN0IGFwcCA9IGV4cHJlc3MoKTtcblxuYXBwLnVzZShleHByZXNzLmpzb24oKSk7XG5cbi8vIFRvRG/kuIDopqfjga7lj5blvpdcbmFwcC5nZXQoJy9hcGkvdG9kb3MnLCAocmVxLCByZXMsIG5leHQpID0+IHtcbiAgaWYgKCFyZXEucXVlcnkuY29tcGxldGVkKSB7XG4gICAgcmV0dXJuIGRhdGFTdG9yYWdlLmZldGNoQWxsKCkudGhlbih0b2RvcyA9PiByZXMuanNvbih0b2RvcyksIG5leHQpO1xuICB9XG4gIGNvbnN0IGNvbXBsZXRlZCA9IHJlcS5xdWVyeS5jb21wbGV0ZWQgPT09ICd0cnVlJztcbiAgZGF0YVN0b3JhZ2UuZmV0Y2hCeUNvbXBsZXRlZChjb21wbGV0ZWQpLnRoZW4odG9kb3MgPT4gcmVzLmpzb24odG9kb3MpLCBuZXh0KTtcbn0pO1xuXG4vLyBUb0Rv44Gu5paw6KaP55m76YyyXG5hcHAucG9zdCgnL2FwaS90b2RvcycsIChyZXEsIHJlcywgbmV4dCkgPT4ge1xuICBjb25zdCB7IHRpdGxlIH0gPSByZXEuYm9keTtcblxuICBpZiAodHlwZW9mIHRpdGxlICE9PSAnc3RyaW5nJyB8fCAhdGl0bGUpIHtcbiAgICAvLyB0aXRsZeOBjOODquOCr+OCqOOCueODiOOBq+WQq+OBvuOCjOOBquOBhOWgtOWQiOOBr+OCueODhuODvOOCv+OCueOCs+ODvOODiTQwMChCYWQgUmVxdWVzdClcbiAgICBjb25zdCBlcnIgPSBuZXcgRXJyb3IoJ3RpdGxlIGlzIHJlcXVpcmVkJyk7XG4gICAgZXJyLnN0YXR1c0NvZGUgPSA0MDA7XG4gICAgcmV0dXJuIG5leHQoZXJyKTtcbiAgfVxuICBjb25zdCB0b2RvID0geyBpZDogdXVpZHY0KCkgLyogVVVJROOBrueUn+aIkCAqLywgdGl0bGUsIGNvbXBsZXRlZDogZmFsc2UgfTtcbiAgZGF0YVN0b3JhZ2UuY3JlYXRlKHRvZG8pLnRoZW4oKCkgPT4gcmVzLnN0YXR1cygyMDEpLmpzb24odG9kbyksIG5leHQpO1xufSk7XG5cbi8qKiBDb21wbGV0ZWTjga7oqK3lrprjgIHop6PpmaTjga7lhbHpgJrlh6bnkIYgKiovXG5mdW5jdGlvbiBjb21wbGV0ZWRIYW5kbGVyKGNvbXBsZXRlZCkge1xuICByZXR1cm4gKHJlcSwgcmVzLCBuZXh0KSA9PlxuICAgIGRhdGFTdG9yYWdlLnVwZGF0ZShyZXEucGFyYW1zLmlkLCB7IGNvbXBsZXRlZCB9KVxuICAgICAgLnRoZW4odG9kbyA9PiB7XG4gICAgICAgIGlmICh0b2RvKSB7XG4gICAgICAgICAgcmV0dXJuIHJlcy5qc29uKHRvZG8pO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGVyciA9IG5ldyBFcnJvcignVG9EbyBub3QgZm91bmQnKTtcbiAgICAgICAgZXJyLnN0YXR1c0NvZGUgPSA0MDQ7XG4gICAgICAgIG5leHQoZXJyKTtcbiAgICAgIH0sIG5leHQpXG59O1xuXG4vLyBUb0Rv44GuQ29tcGxldGVk44Gu6Kit5a6a44CB6Kej6ZmkXG5hcHAucm91dGUoJy9hcGkvdG9kb3MvOmlkL2NvbXBsZXRlZCcpXG4gIC5wdXQoY29tcGxldGVkSGFuZGxlcih0cnVlKSlcbiAgLmRlbGV0ZShjb21wbGV0ZWRIYW5kbGVyKGZhbHNlKSlcblxuLy8gVG9Eb+OBruWJiumZpFxuYXBwLmRlbGV0ZSgnL2FwaS90b2Rvcy86aWQnLCAocmVxLCByZXMsIG5leHQpID0+IHtcbiAgZGF0YVN0b3JhZ2UucmVtb3ZlKHJlcS5wYXJhbXMuaWQpLnRoZW4oaWQgPT4ge1xuICAgIGlmIChpZCAhPT0gbnVsbCkge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoMjA0KS5lbmQoKTtcbiAgICB9XG4gICAgY29uc3QgZXJyID0gbmV3IEVycm9yKCdUb0RvIG5vdCBmb3VuZCcpO1xuICAgIGVyci5zdGF0dXNDb2RlID0gNDA0O1xuICAgIG5leHQoZXJyKTtcbiAgfSwgbmV4dCk7XG59KTtcblxuLy8g44Ko44Op44O844OP44Oz44OJ44Oq44Oz44Kw44Of44OJ44Or44Km44Kn44KiXG5hcHAudXNlKChlcnIsIHJlcSwgcmVzLCBuZXh0KSA9PiB7XG4gIGNvbnNvbGUuZXJyb3IoZXJyKTtcbiAgcmVzLnN0YXR1cyhlcnIuc3RhdHVzQ29kZSB8fCA1MDApLmpzb24oeyBlcnJvcjogZXJyLm1lc3NhZ2UgfSk7XG59KTtcblxuLy8gXCJtb2R1bGUuZXhwb3J0c1wi44KS6L+95YqgXG5tb2R1bGUuZXhwb3J0cyA9IGFwcC5saXN0ZW4oMzAwMCk7XG4iXX0=